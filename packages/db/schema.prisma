
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Supplier {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  quotes    Quote[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Part {
  id        String   @id @default(cuid())
  nsn       String   @unique
  name      String
  spec      String?
  rfqItems  RFQItem[]
  quoteItems QuoteItem[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RFQ {
  id        String   @id @default(cuid())
  rfqNumber String   @unique
  buyer     String
  dueDate   DateTime
  items     RFQItem[]
  status    String   @default("OPEN")
  source    String   // ERP, GOV, EMAIL, PDF
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RFQItem {
  id        String   @id @default(cuid())
  rfq       RFQ      @relation(fields: [rfqId], references: [id])
  rfqId     String
  part      Part     @relation(fields: [partId], references: [id])
  partId    String
  quantity  Int
  notes     String?
}

model Quote {
  id           String      @id @default(cuid())
  supplier     Supplier    @relation(fields: [supplierId], references: [id])
  supplierId   String
  rfq          RFQ         @relation(fields: [rfqId], references: [id])
  rfqId        String
  status       String      @default("DRAFT") // DRAFT, SENT, WON, LOST
  totalPrice   Decimal     @db.Decimal(12,2)
  leadTimeDays Int
  items        QuoteItem[]
  marginPct    Float?
  winProb      Float?      // model output or heuristic
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model QuoteItem {
  id        String   @id @default(cuid())
  quote     Quote    @relation(fields: [quoteId], references: [id])
  quoteId   String
  part      Part     @relation(fields: [partId], references: [id])
  partId    String
  quantity  Int
  unitPrice Decimal  @db.Decimal(10,2)
}

model AuditLog {
  id        String   @id @default(cuid())
  actor     String
  entity    String
  entityId  String
  field     String
  oldValue  String?
  newValue  String?
  createdAt DateTime @default(now())
}
